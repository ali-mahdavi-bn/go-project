package src

import (
	"fmt"
	"go-tel/src/backbone/helpers/errors_handler"
	"go-tel/src/backbone/infrastructr/databases"
	"gorm.io/gorm"
)

type GormUnitOfWork struct {
	DB *gorm.DB
}

func NewGormUnitOfWork() GormUnitOfWork {
	db, err := databases.SetupDatabase()
	fmt.Println(err)
	return GormUnitOfWork{DB: db}
}

func (uow *GormUnitOfWork) Begin() (*gorm.DB, error) {
	tx := uow.DB.Begin()
	if tx.Error != nil {
		return nil, tx.Error
	}
	return tx, nil
}

func (uow *GormUnitOfWork) Commit(tx *gorm.DB) error {
	return tx.Commit().Error
}

func (uow *GormUnitOfWork) Rollback(tx *gorm.DB) error {
	return tx.Rollback().Error
}

func (uow *GormUnitOfWork) Transaction(f func(tx *gorm.DB) (any, error)) any {
	tx, err := uow.Begin()
	errors_handler.ErrorExist(err)
	value, errF := f(tx)
	if errF != nil {
		err = uow.Rollback(tx)
		errors_handler.ErrorExist(err)
		return errF
	}
	return value

}

//===========================================
//===========================================

// Package docs Code generated by swaggo/swag. DO NOT EDIT
//package docs
//
//import (
//"github.com/swaggo/swag"
//"go-tel/src/backbone/api"
//"go-tel/src/backbone/api/middleware"
//)
//
//var DocTemplate = addSwagger()
//
//func addSwagger() string {
//	e := middleware.NewAPIRouter(true)
//	api.InitRoute(e.Group("/api"))
//	//return service_layer.Add()
//	return "{\n    \"swagger\": \"2.0\",\n    \"info\": {\n        \"description\": \"This is a sample server for using Swagger with Echo.\",\n        \"title\": \"Swagger Example API\",\n        \"contact\": {},\n        \"version\": \"1.0\"\n    },\n    \"host\": \"localhost:8080\",\n    \"basePath\": \"/api/v1\",\n    \"paths\": {\n        \"/a\": {\n            \"get\": {\n                \"description\": \"get the status of server.\",\n                \"produces\": [\n                    \"application/json\"\n                ],\n                \"tags\": [\n                    \"root\"\n                ],\n                \"summary\": \"Show the status of server.\",\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"OK\",\n                        \"schema\": {\n                            \"type\": \"object\",\n                            \"additionalProperties\": true\n                        }\n                    }\n                }\n            }\n        },\n        \"/abc\": {\n            \"get\": {\n                \"description\": \"get the status of server.\",\n                \"produces\": [\n                    \"application/json\"\n                ],\n                \"tags\": [\n                    \"root\"\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"OK\",\n                        \"schema\": {\n                            \"type\": \"object\",\n                            \"additionalProperties\": true\n                        }\n                    }\n                }\n            }\n        },\n        \"/bbbggg\": {\n            \"get\": {\n                \"description\": \"get the status of server.\",\n                \"produces\": [\n                    \"application/json\"\n                ],\n                \"tags\": [\n                    \"root\"\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"OK\",\n                        \"schema\": {\n                            \"type\": \"object\",\n                            \"additionalProperties\": true\n                        }\n                    }\n                }\n            }\n        }\n    }\n}"
//}
//
//// SwaggerInfo holds exported Swagger Info so clients can modify it
//var SwaggerInfo = &swag.Spec{
//	Version:          "1.0",
//	Host:             "localhost:8080",
//	BasePath:         "/",
//	Schemes:          []string{},
//	Title:            "AliProject",
//	Description:      "This is a sample AliProject.",
//	InfoInstanceName: "docs",
//	SwaggerTemplate:  DocTemplate,
//	LeftDelim:        "{{",
//	RightDelim:       "}}",
//}
//
//func init() {
//	swag.Register(SwaggerInfo.InstanceName(), SwaggerInfo)
//}
